[user]
	name = Keith Devens
[include]
	# allow machine-specific configuration (eg. work vs home)
	path = ~/.config/.machine/.gitconfig
[push]
	default = current
[pull]
	rebase = merges
[rebase]
	autoStash = true
[status]
	showUntrackedFiles = all

[diff]
	tool = kdiff3
[merge]
	tool = kdiff3
[difftool]
	prompt = false
[mergetool]
	prompt = false

[difftool "sourcetree"]
	cmd = opendiff \"$LOCAL\" \"$REMOTE\"
	path =
[mergetool "sourcetree"]
	cmd = /Applications/Sourcetree.app/Contents/Resources/opendiff-w.sh \"$LOCAL\" \"$REMOTE\" -ancestor \"$BASE\" -merge \"$MERGED\"
	trustExitCode = true
[difftool "vscode"]
	cmd = code -nwd $LOCAL $REMOTE

# below settings for pager + colors suggested by diff-so-fancy
# https://github.com/so-fancy/diff-so-fancy
[core]
	pager = diff-so-fancy | less --tabs=4 -RFX
	editor = code -nw

[color "diff"]
	meta = yellow
	frag = magenta bold
	commit = yellow bold
	whitespace = red reverse

[alias]
	# list all aliases
	alias = !git config --get-regexp '^alias\\.' | perl -pe 's/[^.]+\\.([^=\\s]+).*$/$1/'
	a = add
	af = !git pick-status-files a
	aa = a -A
	au = a -u
	ap = a -p
	rp = reset -p # reset --patch is the opposite of add --patch
	rpc = !git pick-commit | xargs -toI% git rp %~  # "oops that shouldn't be in that commit"
	b = branch
	br = b -r
	ba = b -a
	bv = !git b --sort=-creatordate | cut -c3- | xargs git commit-info
	brv = branch --sort=-creatordate --format='%(color:reset)%(creatordate:short) %(color:bold white)%(align:2,right)%(upstream:trackshort)%(end)%(color:nobold) %(align:40,left)%(color:yellow)%(refname:short)%(end) %(color:reset)%(contents:subject)'
	bf = !git bv --color=always | fzi --ansi | awk '{print $2}' | xargs -t git co
	commit-info = show --no-patch --date=short --pretty=format:'%C(green)%ad%C(reset) %C(magenta)%C(italic)%<(25,trunc)%S%C(reset) %C(auto)%h %C(blue)%<(20,trunc)%an %C(auto)%<(70,trunc)%s%D%C(reset)'
	current-branch = symbolic-ref --short HEAD
	current-tags = tag --list --points-at HEAD
	c = commit
	cm = c -m
	ca = c -a
	cam = c -am
	cmp  = "!f() { git cm \"$@\" && git p; }; f"
	camp = "!f() { git cam \"$@\" && git p; }; f"
	co = checkout
	cof = !git pick-status-files co
	cf = !git cof
	cob = co -b
	ccb = !git clone "$(cb)"
	clone-insecure = clone -c http.sslVerify=false
	d = diff
	dt = difftool
	dc = !git pick-commit | xargs -t git d
	dtc = !git pick-commit | xargs -t git dt
	df = !git pick-status-files d
	dtf = !git pick-status-files dt
	d1  = "!f() { git d  ${1:-@}^!; }; f"
	dt1 = "!f() { git dt ${1:-@}^!; }; f"
	d1c = !git pick-commit | xargs -t git d1
	dt1c = !git pick-commit | xargs -t git dt1
	ds = d --staged
	dts = dt --staged
	dst = dts
	email = config user.email
	exec = "!exec " # git aliases run from repo root, so can exec something from root
	edit = "!exec $EDITOR ."
	f = fetch
	g = !lazygit
	hash = rev-parse
	hide = update-index --assume-unchanged
	unhide = update-index --no-assume-unchanged
	unhide-all = update-index --really-refresh
	ls = ls-files
	list-hidden = !git ls-files -v | grep '^[a-z]' | cut -c3-
	list-ignored = !git status -s --ignored | grep '^!!' | cut -c4-
	list-untracked = ls-files --others --exclude-standard
	lh = list-hidden
	li = list-ignored
	lu = list-untracked
	m = merge
	ma = m --abort
	mc = m --continue
	mf = m --ff-only
	mn = m --no-ff
	p = "!f() { if git upstream; then git push; else git push -u; fi }; f" # push, set upstream if necessary
	pf = push --force
	pl = pull
	pr = pl --rebase
	pick-commit = !git l1 | fzi --ansi | cut -d' ' -f2
	pc = pick-commit
	pick-status-files = !git status -z | xargs -0n1 | cut -c4- | fzi --print0 | xargs -0t git
	psf = pick-status-files
	sf = psf
	r = rebase --rebase-merges
	ra = rebase --abort
	rc = rebase --continue
	ri = r -i
	ric = !git pick-commit | xargs -tI% git ri %~
	s = status
	st = stash
	stm = st push -m
	stf = !git pick-status-files st push
	stfm = !git pick-status-files st push -m
	stp = st pop
	stl = st list
	std = st drop
	sts = st show
	stsp = st show -p
	w = switch
	w- = w -
	wm = w master
	unstage = reset --
	uns = unstage
	uncommit = reset @~ --
	unc = uncommit
	uncommit-soft = reset --soft @~ --
	uncs = uncommit-soft
	upstream = name-rev @{upstream}
	url = remote get-url origin
	info = remote show origin
	rao = remote add origin
	rso = remote set-url origin
	rro = remote rm origin
	repo-root = rev-parse --show-toplevel
	repo-parent = rev-parse --show-superproject-working-tree # for submodules
	patch = !git --no-pager diff --no-color
	set-upstream = !git branch --set-upstream-to=origin/$(git current-branch)
	l = log --date=format:'%a %Y-%m-%d %k:%M' --color=always --pretty=format:'%C(green)%ad %C(blue)%an <%ae> %C(auto)%h%d%n %s%n%w(0,4,4)%+b%C(reset)' --stat
	lg = "!f() { git log --color=always --graph --pretty=format:'%C(auto)%h %C(green)@%ar@%C(auto)%d %s %C(blue)<%an>%C(reset)' \"$@\" | perl -pe 's/@(\\d+)\\s+(\\w{2})[^@]+@/\"(\".sprintf(\"%02d\", $1).$2.\")\"/e' | less -RFX; }; f"
	l1 = log --date=short --color=always --pretty=format:'%C(green)%ad %C(auto)%h %C(blue)%<(20,trunc)%an %C(auto)%<(70,trunc)%s%d%C(reset)'
	lo = !git l ORIG_HEAD..
	lgo = !git lg ORIG_HEAD..
	l1o = !git l1 ORIG_HEAD..
	prune-merged = !git branch --merged | grep -Ev '^\\*' | grep -Evx '\\s*(master|develop)\\s*' | xargs -n1 git branch -d
	prune-remote = remote prune origin # prune branches deleted from remote
	prune-branches = !git prune-merged && git prune-remote
	most-edited = !git log --pretty=format: --name-only | sort | uniq -c | sort -rg | head -20
	authors = shortlog -sne
	fl = commit --amend -C@ # fix last
	al = commit --amend -c@ # amend last
	ac = "!f() { export c=$(git pick-commit); [[ -z $c ]] && return; GIT_SEQUENCE_EDITOR='git reword-editor' git ri $c~ || git ra; }; f"
	reword-editor = "!f() { perl -pi -e \"s/^(pick\\s+)$c/reword $c/\" $1; }; f"
	fc = !git pick-commit | xargs -t git fixup
	sc = !git pick-commit | xargs -t git squash
	fixup  = "!f() { git commit --fixup  $1      && GIT_EDITOR=true          git ri --autosquash $1~; }; f"
	squash = "!f() { git commit --squash $1 -C$1 && GIT_SEQUENCE_EDITOR=true git ri --autosquash $1~; }; f"

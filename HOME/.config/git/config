[user]
	name = Keith Devens
[include]
	# allow machine-specific configuration (eg. work vs home)
	path = ~/.config/.machine/.gitconfig
[push]
	default = current
[pull]
	rebase = merges
[rebase]
	autoStash = true
[status]
	showUntrackedFiles = all
[apply]
	whitespace = nowarn

[diff]
	tool = kdiff3
	renameLimit = 1000
[merge]
	tool = kdiff3
[difftool]
	prompt = false
[mergetool]
	prompt = false

[difftool "sourcetree"]
	cmd = opendiff \"$LOCAL\" \"$REMOTE\"
	path =
[mergetool "sourcetree"]
	cmd = /Applications/Sourcetree.app/Contents/Resources/opendiff-w.sh \"$LOCAL\" \"$REMOTE\" -ancestor \"$BASE\" -merge \"$MERGED\"
	trustExitCode = true
[difftool "vscode"]
	cmd = code -nwd $LOCAL $REMOTE

# below settings for pager + colors suggested by diff-so-fancy
# https://github.com/so-fancy/diff-so-fancy
[core]
	pager = diff-so-fancy | less -R
	editor = code -nw

[color "diff"]
	meta = yellow
	frag = magenta bold
	commit = yellow bold
	whitespace = red reverse

[filter "lfs"]
	clean = git-lfs clean -- %f
	smudge = git-lfs smudge -- %f
	process = git-lfs filter-process
	required = true

[alias]
	# list all aliases
	alias = !git config --get-regexp '^alias\\.' | perl -pe 's/[^.]+\\.([^=\\s]+).*$/$1/'
	a = add
	af = !git pick-status-files a
	aa = a -A
	au = a -u
	ap = a -p
	rp = reset -p # reset --patch is the opposite of add --patch
	rpc = !git pick-commits | xargs -toI% git rp %~  # "oops that shouldn't be in that commit"
	b = branch
	br = b -r
	ba = b -a
	bv = !git b --sort=-creatordate | cut -c3- | xargs git commit-info
	brv = !git br --sort=-creatordate | rg -v ' -> ' | cut -c3- | xargs git commit-info
	bf = !git pick-branch | xargs -t git w
	brf = !git brv --color=always | fzf0 --ansi | xargs -t git w -t
	pick-branch = !git bv --color=always | fzf0 --ansi
	# tac to reverse the output from fzf (defaulted to --reverse, i.e. newest
	# commits at the top) into the natural order of the commits for cherry-pick
	cp = !git pick-branch | xargs git pick-commits | tac | xargs -t git cherry-pick
	commit-info = show --no-patch --date=short --pretty=format:'%S%x00%C(green)%ad%C(reset) %C(magenta)%C(italic)%<(40,trunc)%S%C(reset) %C(auto)%h %C(blue)%<(15,trunc)%an %C(auto)%<(65,trunc)%s%D%C(reset)'
	current-branch = symbolic-ref --short HEAD
	current-tags = tag --list --points-at HEAD
	c = commit
	cm = c -m
	ca = c -a
	cam = c -am
	cmp  = "!f() { git cm \"$@\" && git p; }; f"
	camp = "!f() { git cam \"$@\" && git p; }; f"
	co = checkout
	cof = !git pick-status-files co
	cf = !git cof
	cob = co -b
	clone-insecure = clone -c http.sslVerify=false
	d = diff
	dt = difftool
	dc = !git pick-commits | xargs -t git d
	dtc = !git pick-commits | xargs -t git dt
	df = !git pick-status-files d
	dtf = !git pick-status-files dt
	d1  = "!f() { git d  ${1:-@}^!; }; f"
	dt1 = "!f() { git dt ${1:-@}^!; }; f"
	d1c = !git pick-commits | xargs -t git d1
	dt1c = !git pick-commits | xargs -t git dt1
	ds = d --staged
	dts = dt --staged
	dst = dts
	delete-branch = !git b | rg -v 'master|^\\*' | fzf | xargs -tp -L1 git b --delete
	delete-remote = !git br | rg -v 'HEAD|master' | fzf | awk -F/ '{print \"git push \" $1 \" --delete \" $2}' | xargs -I% -tp -L1 sh -c '%'
	e = restore
	ef = !git pick-status-files e
	email = config user.email
	exec = "!exec " # git aliases run from repo root, so can exec something from root
	edit = "!exec $EDITOR ."
	f = fetch
	g = !lazygit
	hash = rev-parse
	hide = update-index --assume-unchanged
	unhide = update-index --no-assume-unchanged
	unhide-all = update-index --really-refresh
	ls = ls-files
	list-hidden = !git ls-files -v | grep '^[a-z]' | cut -c3-
	list-ignored = !git status -s --ignored | grep '^!!' | cut -c4-
	list-untracked = ls-files --others --exclude-standard
	lh = list-hidden
	li = list-ignored
	lu = list-untracked
	m = merge
	ma = m --abort
	mc = m --continue
	mf = m --ff-only
	mn = m --no-ff
	p = "!f() { if git upstream; then git push; else git push -u; fi }; f" # push, set upstream if necessary
	pf = "!f() { echo \"On branch $(git current-branch)\"; echo push | xargs -p -I% git % --force; }; f" # push --force, requiring confirmation
	pl = pull
	pg = !git pl && git lgo
	pr = pl --rebase
	pick-commits = "!f() { git l1 \"${1:-.}\" | fzf --ansi | cut -d' ' -f2; }; f"
	pc = pick-commits
	pick-status-files = !git status -z | xargs -0n1 | cut -c4- | fzf --print0 --preview='git d --color=always -- {} | $(git config core.pager || echo cat)' | xargs -0t git
	psf = pick-status-files
	sf = psf
	r = rebase --rebase-merges
	ra = rebase --abort
	rc = rebase --continue
	ri = r -i
	ric = !git pick-commits | xargs -tI% git ri %~
	s = status
	st = stash
	stm = st push -m
	stu = stash --include-untracked
	stum = st push --include-untracked -m
	stf = !git pick-status-files st push
	stfm = !git pick-status-files st push -m
	stp = st pop
	stl = st list --pretty=format:'%C(yellow)%gd%C(reset) %C(green)(%cr)%C(reset) %s'
	std = st drop
	sts = st show
	stsp = st show -p
	w = switch-autostash
	w- = w -
	wc = w -c
	wm = w master
	unstage = reset --
	uns = unstage
	uncommit = reset @~ --
	unc = uncommit
	uncommit-soft = reset --soft @~ --
	uncs = uncommit-soft
	upstream = name-rev @{upstream}
	url = remote get-url origin
	info = remote show origin
	rao = remote add origin
	rso = remote set-url origin
	rro = remote rm origin
	repo-root = rev-parse --show-toplevel
	repo-parent = rev-parse --show-superproject-working-tree # for submodules
	patch = !git --no-pager diff --no-color
	set-upstream = !git branch --set-upstream-to=origin/$(git current-branch)
	l = log --date=format:'%a %Y-%m-%d %k:%M' --color=always --pretty=format:'%C(green)%ad %C(blue)%an <%ae> %C(auto)%h%d%n %s%n%w(0,4,4)%+b%C(reset)' --stat
	lg = "!f() { git log --color=always --graph --pretty=format:'%C(auto)%h %C(green)@%ar@%C(auto)%d %s %C(blue)<%an>%C(reset)' \"$@\" | perl -pe 's/@(\\d+)\\s+(\\w{2})[^@]+@/\"(\".sprintf(\"%02d\", $1).$2.\")\"/e' | less -RFX; }; f"
	l1 = log --date=short --color=always --pretty=format:'%C(green)%ad %C(auto)%h %C(blue)%<(15,trunc)%an %C(auto)%<(65,trunc)%s%d%C(reset)'
	lo = !git l ORIG_HEAD..
	lgo = !git lg ORIG_HEAD..
	l1o = !git l1 ORIG_HEAD..
	prune-merged = !git branch --merged | grep -Ev '^\\*' | grep -Evx '\\s*(master|develop)\\s*' | xargs -n1 git branch -d
	prune-remote = remote prune origin # prune branches deleted from remote
	prune-branches = !git prune-merged && git prune-remote
	pb = prune-branches
	most-edited = !git log --pretty=format: --name-only | sort | uniq -c | sort -rg | head -20
	authors = shortlog -sne
	fl = commit --amend -C@ # fix last
	al = commit --amend -c@ # amend last
	ac = "!f() { export c=$(git pick-commits); [[ -z $c ]] && return; GIT_SEQUENCE_EDITOR='git reword-editor' git ri $c~ || git ra; }; f"
	reword-editor = "!f() { perl -pi -e \"s/^(pick\\s+)$c/reword $c/\" $1; }; f"
	fc = !git pick-commits | xargs -t git fixup
	sc = !git pick-commits | xargs -t git squash
	fixup  = "!f() { git commit --fixup  $1      && GIT_EDITOR=true          git ri --autosquash $1~; }; f"
	squash = "!f() { git commit --squash $1 -C$1 && GIT_SEQUENCE_EDITOR=true git ri --autosquash $1~; }; f"

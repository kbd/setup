#!/usr/bin/env nu
let result = (rg '^func\s+(Test[A-Z0-9]\w*)' -or '$1' --no-heading --with-filename --no-line-number --sort=path | fzf)

#https://www.nushell.sh/book/scripts.html#parameterizing-scripts
echo $"result: ($result)"
let path_test = ($result | split column :)
let path = ($path_test | select column1 | get 0)
let path_dir = ($path.column1 | path parse | get parent)
let test = ($path_test | select column2 | get 0 | str trim)

def dlv_debug [dir test] {
  echo $"dlv test \"./($dir)\" -- -test.run \"^($test)$\""
  dlv test $"./($dir)" -- -test.run $"^($test)$"
}

# how to pass command line arguments in nu?
# def go_test [dir test] {
#   echo $"go test $\"./($dir)\" -v -run $\"^($test)$\""
#   go test $"./($dir)" -v -run $"^($test)$"
# }

dlv_debug $path_dir $test.column2

# add a keyboard shortcut to fzf to sort by path or test function name?

#!/usr/bin/env python3

"""Show arguments provided in argv

Some examples of why this is handy:

Show how arguments are sent by the shell:
$ var="hello world"
$ ./argv $var
['./argv', 'hello', 'world']
$ ./argv "$var"
['./argv', 'hello world']

Show how subprocess.call sends arguments:
$ python3
...
>>> import subprocess
>>> subprocess.call(['./argv', 'hello world'])
['./argv', 'hello world']
0
>>> subprocess.call(['./argv', 'hello world'], shell=True)  # wrong
['./argv']
0
>>> subprocess.call('./argv hello world', shell=True)
['./argv', 'hello', 'world']
0

Show how 'python' and 'ipython' process arguments differently:
~$ python -i bin/argv -i
['bin/argv', '-i']
...
~$ ipython -i bin/argv -i
['.../bin/argv']
...


"""
import os
from sys import argv, exit, stderr, stdin, stdout


def myprint(*args, **kwargs):
    print(*args, **{'file': stderr} | kwargs)
    if FILE:
        with open(FILE, "a") as f:
            print(*args, **kwargs | {'file': f})

if __name__ == '__main__':
    # if ARGV_FILE set, also write output to that file
    if FILE := os.environ.get("ARGV_FILE"):
        FILE = os.path.expanduser(FILE)

    myprint(f"{os.getcwd()=}")

    if int(os.environ.get("ARGV_TTY", 0)):
        myprint(f"{stdin.isatty()=}")
        myprint(f"{stdout.isatty()=}")
        myprint(f"{stderr.isatty()=}")

    if not stdin.isatty():  # if pipeline
        myprint(f"{stdin.read()=}")

    if vars := {
        k: v
        for k, v in os.environ.items()
        if k.upper().startswith("ARGV_")
    }:
        myprint("VARS:", vars)

    myprint(argv, file=stdout)
    exit(int(os.environ.get("ARGV_RETURN", 0)))

#!/usr/bin/env python3

"""
Take a 'from' and 'to' directory. If any directory in 'from' is a symlink to
a diretory in 'to', delete the symlink (so that it can be replaced by setup).

That was the original plan, but it suffices to delete any symlinks in $HOME that
point to directories, with some ad-hoc restrictions.

This is a temporary script to upgrade from, I guess, version 1 to version 2 of
setup symlinks. Essentially every dir is now a "partial", and no directories
should be symlinked, so remove any that were.
"""
import os
import sys
from pathlib import Path

from lib.utils import run

if __name__ == "__main__":
    # walk all *directories* in home that are symlinks
    dirs = run(['fd', '-uu', '-tl', '', Path.home()], cap=True).splitlines()
    for d in dirs:
        p = Path(d)
        if p.is_dir() \
            and '/proj' not in str(p) \
            and (
                '/Library/' not in str(p)
                or '/Code/' in str(p)
                or '/Sublime' in str(p)
            ):
            print(f'Removing symlink at {p} that points to {os.readlink(p)}')
            p.unlink()

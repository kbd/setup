#!/usr/bin/env python3
import os
import sys
from subprocess import run

# create directory
os.mkdir(sys.argv[1])
os.chdir(sys.argv[1])

# initialize poetry with default dependencies, create virtualenv
cmd = ['git', 'config', '--get', '--global', 'user.name']
username = run(cmd, check=True, capture_output=True, text=True).stdout.strip()

cmd = [
  'poetry', 'init',
  '--no-interaction',
  '--name', sys.argv[1],
  '--author', username,
  '--dev-dependency=black',
  '--dev-dependency=ipython',
  '--dev-dependency=mypy',
  '--dev-dependency=pylint',
  '--dev-dependency=pytest',
]
run(cmd, check=True)
run(['poetry', 'install'], check=True)

# set up direnv
with open('.envrc', 'w') as f:
  f.write("layout poetry\n")
run(['direnv', 'allow'], check=True)

# add files to git
run(['git', 'init'], check=True)
run(['git', 'add', '--all'], check=True)

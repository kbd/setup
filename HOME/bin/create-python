#!/usr/bin/env python3
import logging
import sys

import sh

fgsh = sh(_fg=True)

from fgsh import cd, direnv, echo, git, mkdir, poetry

logging.basicConfig(level=logging.INFO)

# create directory
mkdir(sys.argv[1])
cd(sys.argv[1])

# initialize poetry with default dependencies, create virtualenv
poetry.init(
  no_interaction = True,
  name = sys.argv[1],
  author = sh.git.config('--get', '--global', 'user.name').strip(),
  dev_dependency = ['black', 'ipython', 'mypy', 'pylint', 'pytest'],
)
poetry.install()

# set up direnv
echo("layout poetry", _out='.envrc')
direnv.allow()

# add files to git
git.init()
git.add('--all')

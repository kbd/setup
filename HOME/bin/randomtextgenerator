#!/usr/bin/env python3
import argparse
import os
import random
import sys
import time
from datetime import datetime, timedelta
from itertools import product

from lib import colors


def randomtext(style, outputs=[sys.stdout, sys.stderr]):
    print(
        *style, os.getpid(), datetime.now().isoformat(), colors.s.reset,
        file=random.choice(outputs)
    )


def main(args):
    all_style_names = list(product(colors.fg, colors.bg))
    # remove fg=bg so that you don't get eg. white text on white background
    style_names = [s for s in all_style_names if s[0] != s[1]]
    style_name = random.choice(style_names)
    style = (colors.fg[style_name[0]], colors.bg[style_name[1]])

    if not args.interval:
        return randomtext(style)

    endtime = datetime.now() + timedelta(seconds=args.timeout) if args.timeout else None
    while True:
        randomtext(style)
        if args.timeout:
            now = datetime.now()
            then = now + timedelta(seconds=args.interval)
            if then > endtime:
                break
        time.sleep(args.interval)


if __name__ == '__main__':
    parser = argparse.ArgumentParser(description='Generate "random" text')
    parser.add_argument('interval', nargs="?", type=float, default=0)
    parser.add_argument('timeout', nargs="?", type=float, default=0)
    args = parser.parse_args()
    try:
        main(args)
    except KeyboardInterrupt:
        pass
